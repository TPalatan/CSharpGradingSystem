@model IDictionary<GradingSystem.Models.Subject, List<GradingSystem.Models.Student>>
@{
    Layout = "~/Views/Shared/_TeacherLayout.cshtml";
    ViewData["Title"] = "Grades";
}

<div style="max-width: 1200px; margin: 30px auto; font-family: 'Segoe UI', sans-serif;">
    <h2 style="color:#007bff; text-align:center; margin-bottom:30px;">Student Grades</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div style="background:#d4edda; color:#155724; padding:10px 15px; border-radius:5px; margin-bottom:20px;">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (Model != null && Model.Any())
    {
        @foreach (var kvp in Model)
        {
            var subject = kvp.Key;
            var students = kvp.Value;

            <h3 style="margin-top:40px; color:#333;">@subject.SubjectName (@subject.SubjectCode)</h3>

            <form asp-action="SaveGrades" method="post">
                <input type="hidden" name="subjectId" value="@subject.Id" />

                <table style="width:100%; border-collapse:collapse; margin-top:15px;">
                    <thead style="background-color:#007bff; color:white;">
                        <tr>
                            <th style="padding:10px;">Student ID</th>
                            <th>Full Name</th>
                            <th>Course</th>
                            <th>Prelim</th>
                            <th>Midterm</th>
                            <th>Semi-Final</th>
                            <th>Final</th>
                            <th>Final Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < students.Count; i++)
                        {
                            var student = students[i];
                            var grade = ViewData[$"Grade_{subject.Id}_{student.Id}"] as GradingSystem.Models.Grade;

                            <tr style="border-bottom:1px solid #ddd;">
                                <td style="padding:8px;">@student.StudentID</td>
                                <td>@student.FullName</td>
                                <td>@student.Course</td>
                                <td>
                                    <input type="number" name="prelim" min="0" max="100" step="0.1" style="width:70px;"
                                           value="@(grade?.Prelim.HasValue == true ? grade.Prelim.Value.ToString("0.##") : "")" />
                                </td>
                                <td>
                                    <input type="number" name="midterm" min="0" max="100" step="0.1" style="width:70px;"
                                           value="@(grade?.Midterm.HasValue == true ? grade.Midterm.Value.ToString("0.##") : "")" />
                                </td>
                                <td>
                                    <input type="number" name="semifinal" min="0" max="100" step="0.1" style="width:70px;"
                                           value="@(grade?.SemiFinal.HasValue == true ? grade.SemiFinal.Value.ToString("0.##") : "")" />
                                </td>
                                <td>
                                    <input type="number" name="final" min="0" max="100" step="0.1" style="width:70px;"
                                           value="@(grade?.Final.HasValue == true ? grade.Final.Value.ToString("0.##") : "")" />
                                </td>
                                <td>
                                    <input type="text" readonly style="width:80px; background:#f5f5f5;"
                                           value="@(grade?.FinalGrade.HasValue == true ? grade.FinalGrade.Value.ToString("0.##") : "")" />
                                </td>

                                <input type="hidden" name="studentIds" value="@student.Id" />
                            </tr>
                        }
                    </tbody>
                </table>

                <div style="margin-top:15px;">
                    <button type="submit" style="background:#007bff; color:white; padding:10px 15px; border:none; border-radius:5px;">
                        Save
                    </button>
                </div>
            </form>
        }
    }
    else
    {
        <p style="text-align:center; color:#777;">No subjects found.</p>
    }
</div>
