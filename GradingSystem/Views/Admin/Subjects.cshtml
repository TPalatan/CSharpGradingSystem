@model IEnumerable<GradingSystem.Models.Subject>

@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Subjects";

    // Group subjects by Department
    var groupedSubjects = Model?
        .GroupBy(s => s.Department)
        .ToDictionary(g => g.Key, g => g.ToList());
}

<div class="container-fluid">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <h2 class="fw-bold text-primary mb-2 mb-md-0">Subject Management</h2>
        <a href="@Url.Action("AddSubject", "Admin")" class="btn btn-primary">
            <i data-lucide="plus-circle" class="me-1"></i> Add New Subject
        </a>
    </div>

    @if (groupedSubjects != null && groupedSubjects.Any())
    {
        @foreach (var deptGroup in groupedSubjects)
        {
            <h4 class="text-secondary mt-4">@deptGroup.Key</h4>

            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body table-responsive p-0">
                    <table class="table table-hover align-middle text-nowrap mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Subject Code</th>
                                <th>Subject Name</th>
                                <th>Department</th>
                                <th>Assigned Teacher</th>
                                <th>Units</th>
                                <th>Semester</th>
                                <th>Status</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int index = 1;
                                foreach (var subject in deptGroup.Value)
                                {
                                    <tr>
                                        <td>@index</td>
                                        <td>@subject.SubjectCode</td>
                                        <td>@subject.SubjectName</td>
                                        <td>@subject.Department</td>
                                        <td>@subject.AssignedTeacher?.FullName</td>
                                        <td>@subject.Units</td>
                                        <td>@subject.Semester</td>
                                        <td>
                                            <span class="badge @(subject.Status == "Active" ? "bg-success" : "bg-secondary")">
                                                @subject.Status
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <a class="btn btn-sm btn-outline-warning" title="Edit" href="@Url.Action("EditSubject", "Admin", new { id = subject.Id })">
                                                <i data-lucide="edit"></i>
                                            </a>
                                            <a class="btn btn-sm btn-outline-danger" title="Delete" href="@Url.Action("DeleteSubject", "Admin", new { id = subject.Id })" onclick="return confirm('Are you sure you want to delete this subject?');">
                                                <i data-lucide="trash-2"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    index++;
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    }
    else
    {
        <div class="text-center py-3 text-muted">No subjects available.</div>
    }
</div>

@section Scripts {
    <script>
        lucide.createIcons();
    </script>
}

<style>
    h2.fw-bold, h4.text-secondary {
        letter-spacing: 0.5px;
    }

    .card {
        border-radius: 12px;
    }

    .table-hover tbody tr:hover {
        background-color: #f0f6ff;
    }

    .btn-outline-warning i,
    .btn-outline-danger i {
        width: 16px;
        height: 16px;
    }

    .badge {
        font-size: 0.8rem;
    }

    table th, table td {
        white-space: nowrap;
    }

    .card-body {
        overflow-x: auto;
    }
</style>
